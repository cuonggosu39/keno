<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Keno ‚Äì Th·ªëng k√™ Hot / Cold</title>

<style>
:root{
  --cell-width:75px;
  --cell-height:55px;
  --font-btn:18px;
  --font-cell:22px;
}
body{
  font-family: Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:15px;
  text-align:center;
}
h2{ margin-bottom:6px; }
button{
  font-size:var(--font-btn);
  padding:8px 18px;
  margin:6px;
  cursor:pointer;
  border-radius:6px;
}
#info{
  font-size:22px;
  font-weight:bold;
  margin:10px 0;
  white-space:pre-line;
}
.nav{ margin-bottom:10px; }

/* ===== LAYOUT CH√çNH ===== */
.main-layout{
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:20px;
}

/* ===== B·∫¢NG ===== */
#board{
  margin:0 auto;
  border-collapse:collapse;
}
#board td{
  width:var(--cell-width);
  height:var(--cell-height);
  border:1px solid #aaa;
  font-size:var(--font-cell);
  text-align:center;
  vertical-align:middle;
}
#board td:nth-child(5){ border-right:3px solid #000; }
#board tr:nth-child(4) td{ border-bottom:3px solid #000; }

/* ===== TR·∫†NG TH√ÅI ===== */
.hit{ background:#4caf50; color:#fff; }
.prev-hit{
  text-decoration: underline;
  text-decoration-thickness: 3px;
  text-underline-offset: 6px;
}
.hot1{ color:#ffcc80; font-weight:bold; }
.hot2{ color:#ff9800; font-weight:bold; }
.hot3{ color:#e65100; font-weight:bold; }
.cold1{ color:#90caf9; }
.cold2{ color:#1e88e5; font-weight:bold; }
.cold3{ color:#0d47a1; font-weight:bold; }

/* ===== CH√ö TH√çCH ===== */
.note-box{
  width:260px;
  background:#fafafa;
  padding:12px 14px;
  border-radius:8px;
  font-size:16px;
  line-height:1.6;
  text-align:left;
}
.note-under{
  max-width:900px;
  margin:14px auto 6px;
  font-size:16px;
  line-height:1.6;
}
.note-footer{
  margin-top:8px;
  font-size:16px;
  font-weight:bold;
  color:#333;
}

/* ===== MOBILE ===== */
@media (max-width:900px){
  .main-layout{
    flex-direction:column;
    align-items:center;
  }
  .note-box{
    width:95%;
  }
}
@media (max-width:600px){
  :root{
    --cell-width:50px;
    --cell-height:45px;
    --font-btn:22px;
    --font-cell:16px;
  }
  #info{ font-size:18px; }
}
</style>
</head>

<body>

<h2>Keno ‚Äì Th·ªëng k√™ Hot / Cold (10 k·ª≥ g·∫ßn nh·∫•t)</h2>
<div id="info"></div>

<div class="nav">
  <button onclick="newer()">‚óÄ</button>
  <button onclick="older()">‚ñ∂</button>
</div>

<div class="main-layout">

  <!-- CH√ö TH√çCH TR√ÅI -->
  <div class="note-box">
    üî• <b>HOT</b> ‚Äì xu·∫•t hi·ªán trong 10 k·ª≥ g·∫ßn nh·∫•t:<br>
    ‚Ä¢ 7‚Äì10 l·∫ßn: cam ƒë·∫≠m<br>
    ‚Ä¢ 5‚Äì6 l·∫ßn: cam<br>
    ‚Ä¢ 4 l·∫ßn: cam nh·∫°t
  </div>

  <!-- B·∫¢NG -->
  <table id="board"></table>

  <!-- CH√ö TH√çCH PH·∫¢I -->
  <div class="note-box">
    ‚ùÑ <b>COLD (gan)</b> ‚Äì s·ªë kh√¥ng xu·∫•t hi·ªán li√™n ti·∫øp:<br>
    ‚Ä¢ ‚â•8 k·ª≥ gan: xanh ƒë·∫≠m<br>
    ‚Ä¢ 6‚Äì7 k·ª≥ gan: xanh<br>
    ‚Ä¢ 4‚Äì5 k·ª≥ gan: xanh nh·∫°t
  </div>

</div>

<!-- CH√ö TH√çCH D∆Ø·ªöI B·∫¢NG -->
<div class="note-under">
  üü¢ <b>N·ªÅn xanh l√°</b>: s·ªë tr√∫ng k·ª≥ ƒëang xem<br>
  ‚ñ¨ <b>G·∫°ch ch√¢n</b>: s·ªë tr√∫ng k·ª≥ li·ªÅn tr∆∞·ªõc
  <div class="note-footer">
    K·∫øt qu·∫£ th·ªëng k√™ ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o ‚Äì Keno l√† tr√≤ ch∆°i gi·∫£i tr√≠.
  </div>
</div>

<script>
let results = [];
let index = 0;
const WINDOW = 10;
let lastApiFetch = 0;
const API_COOLDOWN = 60 * 1000;
let lastKnownDraw = null;

/* ===== LOAD DATA T·ª™ GITHUB ===== */
async function loadFromGithub(){
  const res = await fetch("data/latest.json?t=" + Date.now());
  const json = await res.json();
  return json.data.items.map(it => ({
    draw: parseInt(it.drawCode,10),
    date: it.openDate.split(" ")[0],
    time: it.openDate,
    nums: Array.from({length:20},(_,i)=>parseInt(it["num"+(i+1)],10))
  }));
}

/* ===== FETCH API B√ô K·ª≤ ===== */
async function fetchApiIfNeeded(latestDraw){
  if(Date.now() - lastApiFetch < API_COOLDOWN) return [];
  lastApiFetch = Date.now();
  const res = await fetch(
    "https://veso247.vn:19901/api/keno/result/keno?page_size=30&page_index=1",
    { cache:"no-store" }
  );
  const json = await res.json();
  return json.data.items
    .map(it => ({
      draw: parseInt(it.drawCode,10),
      date: it.openDate.split(" ")[0],
      time: it.openDate,
      nums: Array.from({length:20},(_,i)=>parseInt(it["num"+(i+1)],10))
    }))
    .filter(it => it.draw > latestDraw);
}

/* ===== INIT ===== */
async function init(){
  const gh = await loadFromGithub();
  const newestDraw = gh[0]?.draw || 0;
  const apiNew = await fetchApiIfNeeded(newestDraw);
  results = [...apiNew, ...gh];
  render();
}
init();

/* ===== AUTO RELOAD ===== */
async function getLatestDrawFromAPI(){
  try{
    const res = await fetch(
      "https://veso247.vn:19901/api/keno/result/keno?page_size=1&page_index=1",
      { cache:"no-store" }
    );
    const js = await res.json();
    return parseInt(js.data.items[0].drawCode,10);
  }catch(e){ return null; }
}
setInterval(async ()=>{
  if(!results.length) return;
  if(lastKnownDraw === null) lastKnownDraw = results[0].draw;
  const latest = await getLatestDrawFromAPI();
  if(latest && latest > lastKnownDraw) location.reload();
},30000);

/* ===== STATS + RENDER (GI·ªÆ NGUY√äN) ===== */
function calcStats(){
  let freq = Array(81).fill(0);
  let drought = Array(81).fill(WINDOW); // m·∫∑c ƒë·ªãnh: kh√¥ng ra trong window => gan = WINDOW

  const end = Math.min(results.length, index + WINDOW);
  const slice = results.slice(index, end);

  // ƒë·∫øm HOT (gi·ªØ nguy√™n)
  slice.forEach(r => r.nums.forEach(n => freq[n]++));

  // ƒë·∫øm GAN ƒë√∫ng theo 10 k·ª≥
  slice.forEach((r, i) => {
    r.nums.forEach(n => {
      if (drought[n] === WINDOW) {
        drought[n] = i;
      }
    });
  });

  return {freq, drought};
}
function render(){
  if(!results.length) return;
  const cur = results[index];
  const prev = results[index+1]?.nums || [];
  const {freq,drought} = calcStats();
  document.getElementById("info").innerText =
    `Ng√†y ${cur.date} ‚Äì K·ª≥ #${cur.draw}`;
  const tb = document.getElementById("board");
  tb.innerHTML = "";
  let n = 1;
  for(let r=0;r<8;r++){
    let tr=document.createElement("tr");
    for(let c=0;c<10;c++){
      let td=document.createElement("td");
      td.textContent=n.toString().padStart(2,"0");
      if(cur.nums.includes(n)) td.classList.add("hit");
      if(prev.includes(n)) td.classList.add("prev-hit");
      if(freq[n]>=7) td.classList.add("hot3");
      else if(freq[n]>=5) td.classList.add("hot2");
      else if(freq[n]===4) td.classList.add("hot1");
      if(drought[n]>=8) td.classList.add("cold3");
      else if(drought[n]>=6) td.classList.add("cold2");
      else if(drought[n]>=4) td.classList.add("cold1");
      tr.appendChild(td);
      n++;
    }
    tb.appendChild(tr);
  }
}
function older(){ if(index+1<results.length){ index++; render(); } }
function newer(){ if(index>0){ index--; render(); } }
</script>

</body>
</html>



